# This file contains common pin mappings for the BIGTREETECH SKR mini
# E3 v1.2. To use this config, the firmware should be compiled for the
# STM32F103
# "28KiB bootloader"
# USB communication.
# 8mhz cryatal
# !!!!!remember to enable adxl in options!!!!
# Enable extra low-level configuration options" and configure
# "GPIO pins to set at micro-controller startup" to "!PC13".

# The "make flash" command does not work on the SKR mini E3. Instead,
# after running "make", copy the generated "out/klipper.bin" file to a
# file named "firmware.bin" on an SD card and then restart the SKR
# mini E3 with that SD card.

# See docs/Config_Reference.md for a description of parameters.

# Note: This board has a design flaw in its thermistor circuits that
# cause inaccurate temperatures (most noticeable at low temperatures).

# https://docs.vorondesign.com/build/software/miniE3_v12_klipper.html
#
# Compiling the board firmware
# cd klipper
# make menuconfig
# make clean
# make -j4

# you can upgrade Klipper firmware on the skr without removing the sd card from the mainboard if Klipper is already installed:
# cd ~/klipper
# make menuconfig
# !!!!!remember to enable adxl in options!!!!
# make clean
# make -j4
# sudo service klipper stop
# ~/klipper/scripts/flash-sdcard.sh /dev/serial/by-id/usb-Klipper_stm32f103xe_31FFD2054246303113620557-if00 btt-skr-mini-e3-v1.2
# sudo service klipper start

# Compile/upgrade Raspberry Pi MCU Firmware
# cd ~/klipper/
# sudo cp ./scripts/klipper-mcu.service /etc/systemd/system/
# sudo systemctl enable klipper-mcu.service
# make menuconfig
#
# Choose micro-controller Architecture (Linux process)
# Quit and save
#
# make clean
# sudo service klipper stop
# make -j4 flash
# sudo systemctl start klipper-mcu.service
# sudo service klipper start

# Klipper expander
# https://github.com/VoronDesign/Voron-Hardware/blob/master/Klipper_Expander/Documentation/Setup_and_Flashing_Guide.md
# press dfu skirt button and restart
# ssh
# lsusb
# look for : Bus 001 Device 005: ID 0483:df11 STMicroelectronics STM Device in DFU Mode
# cd klipper
# sudo service klipper stop
# make menuconfig
# settings(if the memory storage overruns disable the options you dont need):
# enable extra low-level configuration options
# stm32
# stm32f042
# no bootloader
# internal clock
# usb PA9/PA10
# optional features:
# adc
# Support hardware SPI communication
# Support software SPI communication
# Support hardware PWM (pulse width modulation)
# Support 'neopixel' type LED control
# Support ST7920 LCD display
# Support HD44780 LCD display
# Support thermocouple MAX sensors
# Support HX711 and HX717 ADC chips
# Support ADS 1220 ADC chip
# Support angle sensors
# save and exit
# make clean
# make -j4 flash FLASH_DEVICE=0483:df11
# error message is expected but check the memory usage is okay, if not repeat with less options: dfu-util: can't detach
# press external dfu button and reboot


# Useful Information:
# Pin names may be preceded by ! to indicate that a reverse polarity should be used (eg, trigger on low instead of high).
# Input pins may be preceded by ^ to indicate that a hardware pull-up resistor should be enabled for the pin.


# Demon_Klipper_Essentials_Unified Notes
# https://github.com/3DPrintDemon/Demon_Klipper_Essentials_Unified/tree/main

# Updating
# Original commands:
# python3 -m pip install rich
# python3 -m pip install ConfigUpdater

# Workarounds:
# ~/klippy-env/bin/pip install rich
# ~/klippy-env/bin/python3 -m pip install ConfigUpdater
# ~/klippy-env/bin/python3 ~/printer_data/config/Demon_Klipper_Essentials_Unified/Other_Files/Demon_Install_Script/Demon_config_update.py

# Not needed:
# /home/pi/klippy-env/bin/python3 -m pip install --upgrade pip

[include ./Demon_Klipper_Essentials_Unified/*.cfg]
[include ./Demon_User_Files/*.cfg]
[include ./KAMP_LiTE/*.cfg]
[include ./Neopixel_Control.cfg]
[include ./Heat_Soak_Toolhead_LEDs.cfg]
[include ./My_Macros.cfg]
[include ./Demon_Klipper_Essentials_Unified/Other_Files/Demon_User_Files_Updater/Demon_User_Files_Handler_v*.cfg]


###################################################################################
# MCUs
###################################################################################

################################
# BTT SKR Mini E3 V1.2 Mainboard
################################
[mcu]
#serial:
#baud: 250000
#canbus_uuid:
#canbus_interface:
#restart_method:
#is_non_critical: False
serial: /dev/serial/by-id/usb-Klipper_stm32f103xe_31FFD2054246303113620557-if00

################################
# Klipper Expander
################################
[include configFiles/klipperExpander.cfg]

################################
# Raspberry Pi 3
################################
[include configFiles/raspberryPi.cfg]

###################################################################################
# Danger Klipper Options
###################################################################################
#[danger_options]
#error_on_unused_config_options: True
#allow_plugin_override: False
#multi_mcu_trsync_timeout: 0.025
#homing_elapsed_distance_tolerance: 0.5
#temp_ignore_limits: False
#autosave_includes: False
#bgflush_extra_time: 0.250
#homing_start_delay: 0.001
#endstop_sample_time: 0.000015
#endstop_sample_count: 4
# Logging options:
#minimal_logging: False
#log_statistics: True
#log_config_file_at_startup: True
#log_bed_mesh_at_startup: True
#log_shutdown_info: True
#log_serial_reader_warnings: True
#log_startup_info: True
#log_webhook_method_register_messages: False

###################################################################################
# Main Printer Attributes
###################################################################################
[printer]
# kinematics: corexz
# max_velocity: 350 # theoretical max at 2200 Accel=680MM/s. 20% safety margin, 544MM/s.
# max_accel: 3000 # TEST_SPEED SPEED=500 ITERATIONS=100 ACCEL=3000 failed. TEST_SPEED SPEED=500 ITERATIONS=100 ACCEL=2750 passed. 20% safety margin, 2200 Accel
# max_z_velocity: 50
# max_z_accel: 3000
square_corner_velocity: 4.0
kinematics: limited_corexz
max_velocity: 350 # Hypotenuse of the two values bellow
max_x_velocity: 350
max_y_velocity: 200
max_z_velocity: 350
max_accel: 15000 # Default acceleration of your choice
max_x_accel: 15000
max_y_accel: 6000
max_z_accel: 15000
scale_xy_accel: False # [True/False, default False]

###################################################################################
# Motors
###################################################################################

#step_pin:
#dir_pin:
#enable_pin:
#rotation_distance:
#microsteps:
#full_steps_per_rotation: 200
#gear_ratio:
#step_pulse_duration:
#endstop_pin:
#position_min: 0
#position_endstop:
#position_max:
#homing_speed: 5.0
#homing_retract_dist: 5.0
#homing_retract_speed:
#min_home_dist:
#second_homing_speed:
#homing_positive_dir:
#use_sensorless_homing:

#################################################
# Creality 42-40 Motor (bj42d22-23v01)
# Current Rating: 1.0A
# 1.8 degree/200 steps
# 1/256 Microsteps
# Peak RMS: 0.707/10%-0.636/20%-0.566
# TMC2209:
# Operating volt logic:	3.3 - 5V
# Input voltage:	5.5V-28V
# Max current:	2 A
# sense resistor: 110mOhm
#################################################

[stepper_x]
step_pin: PB13
dir_pin: !PB12
enable_pin: !PB14
microsteps: 32 # TMC2209 acheivable microsteps=8/16/32/64 (without interpolation), 32/64 should introduce noise reduction without positional artifacts
full_steps_per_rotation: 200 # 1.8 degree stepper motor value
# rotation_distance = <full_steps_per_rotation> * <microsteps> / <steps_per_mm>
# Or
# rotation_distance = <belt_pitch> * <number_of_teeth_on_pulley>
# This printer 2mm belt/pulley with 20 teeth
# rotation_distance = 40
rotation_distance: 40
endstop_pin: ^PC0
position_endstop: 218
position_max: 218
# Bed max 232mm
homing_speed: 70
homing_positive_dir: true

###################################################################################
# Motors
###################################################################################
#################################################
# Creality 42-40 Motor (bj42d22-23v01)
# Current Rating: 1.0A
# 1.8 degree/200 steps
# 1/256 Microsteps
# Peak RMS: 0.707/10%-0.636/20%-0.566
# TMC2209:
# Operating volt logic:	3.3 - 5V
# Input voltage:	5.5V-28V
# Max current:	2 A
# sense resistor: 110mOhm
#################################################

[stepper_y]
step_pin: PB10
dir_pin: !PB2
enable_pin: !PB11
microsteps: 32 # TMC2209 acheivable microsteps=8/16/32/64 (without interpolation), 32/64 should introduce noise reduction without positional artifacts
full_steps_per_rotation: 200 # 1.8 degree stepper motor value
# rotation_distance = <full_steps_per_rotation> * <microsteps> / <steps_per_mm>
# Or
# rotation_distance = <belt_pitch> * <number_of_teeth_on_pulley>
# This printer 2mm belt/pulley with 20 teeth
# rotation_distance = 40
rotation_distance: 40
endstop_pin: ^PC1
position_endstop: 0
position_min: 0
position_max: 226
homing_speed: 50
homing_positive_dir: false

###################################################################################
# Motors
###################################################################################
#################################################
# Creality 42-40 Motor (bj42d22-23v01)
# Current Rating: 1.0A
# 1.8 degree/200 steps
# 1/256 Microsteps
# Peak RMS: 0.707/10%-0.636/20%-0.566
# TMC2209:
# Operating volt logic:	3.3 - 5V
# Input voltage:	5.5V-28V
# Max current:	2 A
# sense resistor: 110mOhm
#################################################

[stepper_z]
step_pin: PB0
dir_pin: !PC5
enable_pin: !PB1
microsteps: 32 # TMC2209 acheivable microsteps=8/16/32/64 (without interpolation), 32/64 should introduce noise reduction without positional artifacts
full_steps_per_rotation: 200 # 1.8 degree stepper motor value
# rotation_distance = <full_steps_per_rotation> * <microsteps> / <steps_per_mm>
# Or
# rotation_distance = <belt_pitch> * <number_of_teeth_on_pulley>
# This printer 2mm belt/pulley with 20 teeth
# rotation_distance = 40
rotation_distance: 40
# endstop_pin: ^PC2
endstop_pin: probe:z_virtual_endstop
#position_endstop: 0.0
homing_speed: 40
position_min: -5.0
position_max: 221


#################################################
# LDO-36STH20-1004AH Motor
# Current Rating: 1.0A
# 1.8 degree/200 steps
# NEMA 14
# Rated Temp: 180C
# 100 mNm Holding Torque
# 20mm Body
#################################################
[extruder]
step_pin: PB3
dir_pin: !PB4
enable_pin: !PD2
microsteps: 32 # TMC2209 acheivable microsteps=8/16/32/64 (without interpolation), 32/64 should introduce noise reduction without positional artifacts
full_steps_per_rotation: 200 # 1.8 degree stepper motor value
#rotation_distance: 21.964
rotation_distance: 22.6789511 # clockwork2 default value
gear_ratio: 50:10 #Clockwork2 default value
nozzle_diameter: 0.400
filament_diameter: 1.750
max_extrude_only_distance: 120.0
pressure_advance: 0.0
#pressure_advance_smooth_time: 0.040
pressure_advance_smooth_time: 0.016
heater_pin: PC8
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: PA0
# Calibrated at 230c/0% Fan
pid_version: 1
pid_target: 230.00
pid_tolerance: 0.0200
control: pid
pid_kp: 23.954
pid_ki: 1.638
pid_kd: 87.580
min_temp: 0
max_temp: 300
min_extrude_temp: 0
max_extrude_cross_section: 5 # Needed for the Voron Logo Purge in KAMP
max_extrude_only_velocity: 15

###################################################################################
# Bed Heater
###################################################################################
[heater_bed]
#heater_pin:
#sensor_type:
#sensor_pin:
#control:
#min_temp:
#max_temp:
heater_pin: PC9
sensor_type: ATC Semitec 104GT-2
sensor_pin: PC3
# Calibrated at 100c
pid_version: 1
pid_target: 100.00
pid_tolerance: 0.0200
control: pid
pid_kp: 63.584
pid_ki: 1.333
pid_kd: 758.245
min_temp: 0
max_temp: 130


###################################################################################
# Bed Mesh
###################################################################################

[bed_mesh]
#speed: 50
#horizontal_move_z: 5
#mesh_radius:
#mesh_origin:
#mesh_min:
#mesh_max:
#probe_count: 3, 3
#round_probe_count: 5
#fade_start: 1.0
#fade_end: 0.0
#fade_target:
#split_delta_z: .025
#move_check_distance: 5.0
#mesh_pps: 2, 2
#algorithm: lagrange
#bicubic_tension: .2
#zero_reference_position:
#faulty_region_1_min:
#faulty_region_1_max:
#adaptive_margin:
#bed_mesh_default:
speed: 150
horizontal_move_z: 5
## Example from Voron:	Uncomment for 350mm build
#mesh_min: 40, 40
#mesh_max: 310,310
#zero_reference_position: 175,175 #for use with stock z endstop
# for min/max use probe co-ordinates, not nozzle position
# mesh_min: 20,35.0
# mesh_max: 200.0,200
# probe_count: 5, 5
# fade_start: 0.6
# fade_end: 10
# fade_target: 0
# algorithm: bicubic
# mesh_pps: 2, 2
# bicubic_tension: 0.2 #default
# #bicubic_tension: 0.5
# #zero_reference_position: 109, 113
# adaptive_margin: 5
# X Calculation: 5 (Safety) to 213 (218 Reach - 5 Safety)
# Y Calculation: 25 (Min Physical Offset) to 231 (236 Bed - 5 Safety)
mesh_min: 5, 25
mesh_max: 213, 231
probe_count: 9, 9         ; High density (9x9) is best for Adaptive Meshing
algorithm: bicubic
mesh_pps: 2, 2
bicubic_tension: 0.2
adaptive_margin: 5        ; Adds a 5mm buffer around your print objects

###################################################################################
# Bed Tilt
###################################################################################

#[bed_tilt]
#x_adjust: 0
#y_adjust: 0
#z_adjust: 0
#points:
#speed: 50
#horizontal_move_z: 5

###################################################################################
# Bed Screw Manual Calibration
###################################################################################

#[bed_screws]
#screw1:
#screw1_name:
#screw1_fine_adjust:
#screw2:
#screw2_name:
#screw2_fine_adjust:
#horizontal_move_z: 5
#probe_height: 0
#speed: 50
#probe_speed: 5

###################################################################################
# Bed Screw Automated Calibration
###################################################################################

[screws_tilt_adjust]
#screw1:
#screw1_name:
#screw2:
#screw2_name:
#speed: 50
#horizontal_move_z: 5
#screw_thread: CW-M3

# x locations of the screws on the bed: 25, 196
# y locations of the screws on the bed: 29, 200
screw1: 25, 176
screw1_name: rear left screw
screw2: 196, 8
screw2_name: front right screw
screw3: 196, 176
screw3_name: rear right screw
screw4: 25, 8
screw4_name: front left screw
horizontal_move_z: 4
speed: 100
screw_thread: CW-M4

###################################################################################
# Z Tilt Calibration
###################################################################################

#[z_tilt]
#z_positions:
#points:
#speed: 50
#horizontal_move_z: 5
#min_horizontal_move_z: 1.0
#adaptive_horizontal_move_z: False
#retries: 0
#retry_tolerance: 0
#increasing_threshold: 0.0000001

###################################################################################
# Skew Calibration
###################################################################################
[skew_correction]

###################################################################################
# Z Thermal Adjustment
###################################################################################

#[z_thermal_adjust]
#temp_coeff:
#smooth_time:
#z_adjust_off_above:
#max_z_adjustment:
#sensor_type:
#sensor_pin:
#min_temp:
#max_temp:
#gcode_id:

###################################################################################
# Customized Homing
###################################################################################

# [safe_z_home]
# #home_xy_position: 109, 113 # nozzle/bed center
# #home_xy_position: 109, 89 # probe at center
# home_xy_position: 109, 89 # probe at center
# speed: 100
# z_hop: 10
# z_hop_speed: 5

###################################################################################
# Homing Override
###################################################################################

#[homing_override]
#gcode:
#axes: xyz
#set_position_x:
#set_position_y:
#set_position_z:

###################################################################################
# Macros
###################################################################################

# [include KAMP_Settings.cfg]
[include macros/gitHubBackUp.cfg]
# [include macros/zCalibration.cfg]
# [include macros/bedLeveling.cfg]
# [include macros/delayedGcode.cfg]
# [include macros/inputShapingTools.cfg]
# [include macros/printerCalibration.cfg]
# [include macros/speedCalibration.cfg]
# [include timelapse.cfg]
# [include macros/axisTwistCalibration.cfg]
# [include macros/mechanicalGantryCalibration.cfg]
# [include macros/drift_test.cfg]
# [include macros/adaptive_soak.cfg]

###################################################################################
# Save Variables, persistant on restart
###################################################################################
#[save_variables]
#filename:
#   Required - provide a filename that would be used to save the
#   variables to disk e.g. ~/variables.cfg
[save_variables]
filename = ~/demon_vars.cfg

###################################################################################
# Idle Timeout
###################################################################################

# [idle_timeout]
#gcode:
#   A list of G-Code commands to execute on an idle timeout. See
#   docs/Command_Templates.md for G-Code format. The default is to run
#   "TURN_OFF_HEATERS" and "M84".
#timeout: 1800 # 30 minutes
#timeout: 2400 # 40 minutes
# timeout: 3600 # 60 minutes
[idle_timeout]
gcode:
    _DEMON_IDLE_TIMEOUT
timeout: 3600

###################################################################################
# Virtual SD Card (Handeled in Mainsail
###################################################################################

#[virtual_sdcard]
#path:
#   The path of the local directory on the host machine to look for
#   g-code files. This is a read-only directory (sdcard file writes
#   are not supported). One may point this to OctoPrint's upload
#   directory (generally ~/.octoprint/uploads/ ). This parameter must
#   be provided.
#on_error_gcode:
#   A list of G-Code commands to execute when an error is reported.
#   See docs/Command_Templates.md for G-Code format. The default is to
#   run TURN_OFF_HEATERS.
#with_subdirs: False
#   Enable scanning of subdirectories for the menu and for the
#   M20 and M23 commands. The default is False.

###################################################################################
# Turn on Force Move
###################################################################################

# [force_move]
#enable_force_move: True
#   Set to `True` to enable FORCE_MOVE and SET_KINEMATIC_POSITION
#   extended G-Code commands. The default is `True`.
[force_move]
enable_force_move: True

###################################################################################
# Pause Remove (Handeled in Mainsail)
###################################################################################

#[pause_resume]
#recover_velocity: 50.
#   When capture/restore is enabled, the speed at which to return to
#   the captured position (in mm/s). Default is 50.0 mm/s.

###################################################################################
# Firmware Retraction
###################################################################################

[firmware_retraction]
#retract_length: 0.0
#retract_speed: 20.0
#unretract_extra_length: 0.0
#unretract_speed: 10.0
#z_hop_height: 0.0
retract_length: 0.8
retract_speed: 30
unretract_extra_length: 0.0
unretract_speed: 30

###################################################################################
# G-Code Arcs
###################################################################################

[gcode_arcs]
resolution: 0.1
#   An arc will be split into segments. Each segment's length will
#   equal the resolution in mm set above. Lower values will produce a
#   finer arc, but also more work for your machine. Arcs smaller than
#   the configured value will become straight lines. The default is
#   1mm.

###################################################################################
# Console respond messages
###################################################################################
# [respond]
# #default_type: echo
# #   Sets the default prefix of the "M118" and "RESPOND" output to one
# #   of the following:
# #       echo: "echo: " (This is the default)
# #       command: "// "
# #       error: "!! "
# #default_prefix: echo:
# #   Directly sets the default prefix. If defined, this value will
# #   override the "default_type".
# default_type: command
# default_prefix: MSG=

###################################################################################
# Exclude Object (Enabled by default in Kalico)
###################################################################################

[exclude_object]
enable_exclude_object: True
#   Set to `True` to enable `EXCLUDE_OBJECT_*` extended G-Code commands.
#   The default is `True`.

###################################################################################
# Input Shaper Hardware
###################################################################################

[include configFiles/ADXL345.cfg]

###################################################################################
#Input Shaper Hardware
###################################################################################
[resonance_tester]
# Assign the RPi sensor to the X-axis
accel_chip_x: adxl345 hotend
accel_chip_y: adxl345 bed
probe_points:
    109,113,20

###################################################################################
# Input Shaper
###################################################################################
[input_shaper]
shaper_freq_x: 46.0   #Smoothing
shaper_type_x: mzv     #Smoothing
#To avoid too much smoothing with 'mzv', suggested max_accel <= 7700 mm/sec^2
shaper_freq_y: 37.0
shaper_type_y: mzv # Recommended
# shaper_freq_x: 54.8   #Smoothing
# shaper_type_x: ei     #Smoothing
# #To avoid too much smoothing with 'mzv', suggested max_accel <= 7700 mm/sec^2
# shaper_freq_y: 33.4
# shaper_type_y: ei # Recommended
# #To avoid too much smoothing with 'zv', suggested max_accel <= 3700 mm/sec^2

###################################################################################
# Additional Pins
###################################################################################
[static_digital_output usb_pullup_enable]
pins: !PC13

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PB5, EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8, EXP1_9=<GND>,
    EXP1_2=PB6, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PB7, EXP1_10=<5V>
# See the sample-lcd.cfg file for definitions of common LCD displays.

[output_pin beeper]
pin: EXP1_1

###################################################################################
# Include Files
###################################################################################
# Hardware
[include mainsail.cfg]
[include configFiles/TMCAutoTune.cfg]
# [include configFiles/klippain-shaketune.cfg]
# Macros
# [include macros/bentoBox.cfg]

###################################################################################
# Probe
###################################################################################
[probe]
#pin:
#deactivate_on_each_sample: True
#x_offset: 0.0
#y_offset: 0.0
#z_offset:
#speed: 5.0
#samples: 1
#sample_retract_dist: 2.0
#lift_speed:
#samples_result: average
#samples_tolerance: 0.100
#samples_tolerance_retries: 0
#activate_gcode:
#deactivate_gcode:
#drop_first_result: False
pin: ^PC2
x_offset: 0
y_offset: 25
#z_offset: 0 # default
speed: 5.0
samples: 3
samples_result: median
sample_retract_dist: 3.0
#samples_tolerance: 0.00625 #theoretical best, two step tolerance.
#samples_tolerance: 0.00625
samples_tolerance: 0.0125 # 2x single step accuracy (16 micro steps)
samples_tolerance_retries: 20
drop_first_result: True

###################################################################################
# Axis Twist
###################################################################################

[axis_twist_compensation]
speed: 50
horizontal_move_z: 5
calibrate_start_x: 20
calibrate_end_x: 200
calibrate_y: 113        ; Middle of your usable Y (226 / 2)

###################################################################################
# Host Sensors
###################################################################################

# Now used for Electronics Fan Control. Only one reference allowed
# [temperature_sensor mcu_temp]
# sensor_type: temperature_mcu
# #sensor_mcu: mcu
# min_temp: 0
# max_temp: 100

[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

###################################################################################
# Fans
###################################################################################
#pin:
#max_power: 1.0
#shutdown_speed: 0
#   is 0.
#cycle_time: 0.010
#hardware_pwm: False
#kick_start_time: 0.100
#min_power: 0.0
#tachometer_pin:
#tachometer_ppr: 2
#tachometer_poll_interval: 0.0015
#enable_pin:
#off_below:
#initial_speed:
[heater_fan heatbreak_cooling_fan]
pin: PA8

###################################################################################
# Leds
###################################################################################
# Hardware
[include configFiles/leds.cfg]
# Macros
# [include macros/stealthburner_led_effects_barf.cfg]

###################################################################################
# TMC Driver Configuration
###################################################################################
[tmc2209 stepper_x]
uart_pin: PB15
run_current: 1.1
interpolate: False
#interpolate: True
sense_resistor: 0.110
stealthchop_threshold: 999999
#stealthchop_threshold: 0

[tmc2209 stepper_y]
uart_pin: PC6
run_current: 1.1
interpolate: False
#interpolate: True
sense_resistor: 0.110
stealthchop_threshold: 999999
#stealthchop_threshold: 0

[tmc2209 stepper_z]
uart_pin: PC10
run_current: 1.1
#run_current: 1.300
interpolate: False
#interpolate: True
sense_resistor: 0.110
stealthchop_threshold: 999999
#stealthchop_threshold: 0

[tmc2209 extruder]
uart_pin: PC11
run_current: 0.600
interpolate: False
sense_resistor: 0.110
#stealthchop_threshold: 999999
stealthchop_threshold: 0

###################################################################################
# Display
###################################################################################

######################################################################
# 128x64 Full Graphic Creality CR10 / ENDER 3 stockdisplay
######################################################################

# This section is used for a Creality "12864" display with a single
# ribbon cable between the display's EXP3 plug and the
# micro-controller board's EXP1 connector.

[display]
lcd_type: st7920
menu_timeout: 300 # 5 Minutes
cs_pin: EXP1_7
sclk_pin: EXP1_6
sid_pin: EXP1_8
encoder_pins: ^EXP1_5, ^EXP1_3
click_pin: ^!EXP1_2

###################################################################################
# Custom LCD Menus
###################################################################################

# [include configFiles/lcd_menu_settings.cfg]

###################################################################################
# Network Status (for use with LCD Menus)
###################################################################################

# [include configFiles/networkStatus.cfg]

###################################################################################
# Enclosure Lights Control (for use with LCD Menus)
###################################################################################

# [include macros/enclosureLEDMenuMacro.cfg]

# [include configFiles/enclosureLEDMenuItem.cfg]

###################################################################################
# Filament Runot Sensor
###################################################################################
[include configFiles/bttSmartFilamentSensorV1.cfg]

###################################################################################
# NOTES: Calibrated Build plate Z offsets
###################################################################################
# at 16microsteps set within the theoretical z travel distance of a single step, 0.0125
#
# z_offset = 0.405 #textured PEI

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe]
#*# z_offset = 0.3075
#*#
#*# [skew_correction CaliFlower]
#*# xy_skew = -0.0027118189381268873
#*# xz_skew = 0.0
#*# yz_skew = 0.0
#*#
#*# [skew_correction Calilantern]
#*# xy_skew = -0.0005366960139764193
#*# xz_skew = 0.005814633769281674
#*# yz_skew = 0.002972736342578533
